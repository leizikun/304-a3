---
title: "Title of Your Report"
author: "Names of your Group Members"
date: "Due Date"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(ggplot2)
library(tidyr)
library(dplyr)
library(kableExtra)

# Loading in the cleaned survey Data
survey_data <- read_csv("D:/ps 3/survey_data.csv")
survey_data <- survey_data %>%
  select(vote_trump, age, census_region, employment, race_ethnicity) %>%
  drop_na(vote_trump) #Clean the data 

# Loading in the cleaned census Data
census_data <- read_csv("D:/ps 3/census_data.csv")

```

# Title of your Report

## Name(s) of Author(s) 
## Date


# Model

|     Here we are interested in predicting the popular vote outcome of the 2020 American federal election (include citation). To do this we are employing a post-stratification technique. In the following sub-sections I will describe the model specifics and the post-stratification calculation.


## Model Specifics

|     From the 2018 dataset and () we have selected age, census_region, employment, and race_ethnicity to model the probability of voting for Donald Trump. Based on the label dictionary obtained along with the data, each variables represent the following:
* _vote_trump_ - “A binary column for voting trump or not in the 2020 election. Present 1 if yes, otherwise shows 0”
* age - “Age of respondent in integer at time of interview older than 18 years old”
* census_region - “Respondent’s census region, calculated based on entered ZIP code”
* employment - “Respondent’s current employment status”
* race_ethnicity - “Respondent’s race”

|     We will use a logistic regression model to model the proportion of voters who will vote for Donald Trump. As mentioned above, we will be using age as a numeric variable, census_region, employment, and race_ethnicuty as a character object to model the probability of voting for Donald Trump. Rstudio is used to run the following  logistic regression model. The logistic regression function I am using is shown below:



\begin{align*}
log(\frac{(p)}{1-(p)}) = & {\beta}_0 +
                           {\beta}_1X_{age} +
                          {\beta}_2X_{census\_region:Northeast} + \\
                         &  {\beta}_3X_{census\_region:South} + 
                            {\beta}_4X_{census\_region:West} + \\
                         & {\beta}_5X_{employment:n/a} + 
                            {\beta}_6X_{employment:not\: in\: labor\: force} + \\
                          & {\beta}_7X_{employment:unemployed} + 
                            {\beta}_8X_{race\_ethnicity:Asian\: or\: pacific\: islander} + \\
                        & {\beta}_9X_{race\_ethnicity:Black,\: or\: African\: American} + 
                            {\beta}_{10}X_{race\_ethnicity:Some other\: race\: or\: multiraces} + \\
                         & {\beta}_{11}X_{race\_ethnicity:White} + 
                            {\beta}_{12}X_{marital\_status : Living\: common-law}
\end{align*}                            



|     Where $y$ represents the proportion of voters who will vote for Donald Trump. Similarly, $\beta_0$ represents the intercept of the model, and is the probability of voting for Donald Trump at age 0. Additionally, $\beta_1$ represents the slope of the model. So, for everyone one unit increase in age, we expect a $\beta_1$ increase in the probability of voting for Donald Trump.

```{r, include=TRUE}

# Creating the Model
model <- glm(vote_trump ~ age+as.factor(census_region)+as.factor(employment)+as.factor(race_ethnicity),
            data=survey_data, family= "binomial")

# Model Results (to Report in Results section)
# OR
# broom::tidy(model)

```

## Post-Stratification
|     I performed a post-stratification analysis to estimate the proportion of voters who will vote for Donald Trump in 2020. I create cells in census_data based on combinations of different ages, races, employment status, and living regions. By using the model described in the previous sub-section, I will get the log estimates and then divided by one plus the exponential of the log estimates which will give me each proportion estimate. Finally, use each proportion estimate times the respective population size of that bin and sum those values and divide that by the entire population size. This will give us the probability for president Donald Trump to win the 2020 election.


|     We did not include gender because we thought gender was not likely to influence the voter outcome that much. 

|     Since We are looking at the proportion of people voting for Trump, we want to avoid anything that might be a potential lurking variable. Hence, we chose citizenship as one factor from the census_data and then removed people who are “not a citizen” of America because they do not have the right to vote.



```{r, include=TRUE}

# Here I will perform the post-stratification calculation
census_data$logodds_estimate <-
  model %>%
  predict(newdata = census_data)

census_data$estimate <-
  exp(census_data$logodds_estimate)/(1+exp(census_data$logodds_estimate))

census_data %>%
  mutate(alp_predict_prop = estimate*n) %>%
  summarise(alp_predict = sum(alp_predict_prop)/sum(n))

```


# Results
```{r, include=TRUE}

kable(summary(model)$coeff) %>%
  kable_styling(full_width = F)
```
__Figure 1:__ Key statistical summaries of the logistic regression model. \

|     Before observing the relationships between our chosen predictor variables with whether to vote for Donald Trump or not, we will have to confirm the existence of the relationship first. Upon close inspection of the table above that summarize the results of our model, we can see that the following variables have p-values greater than 0.05: all categories for census_region except people living in the South region, unknown employment status, and white people. This result tells us that we cannot reject the null hypothesis such that there is no effect. For each categorical variable, one category is omitted. The slope of every omitted category is 0. And the slope of other categories of the same variable indicate how they affect the response compared with the missing category.

|     To see whether people are likely or not to vote for Trump, we can check the estimate column. This column provides the coefficients for our logistic regression function specified in the beginning of the model section of this report. Specifically, we can substitute the corresponding variable's $\beta$ symbol. When filling in the values we can observe that the probability of voting for Trump will decrease with factors that have negative estimates. Therefore we can conclude the following characteristics will decrease Trump’s winning possibility: All other races beside white people, people living in Northeast and West region, and all employment status except employed. The rest of the independent variables have positive estimates and as such we can conclude that people who fall in such categories have a likelier outcome of owning a place. For instance, we can see in the plot below that people are more likely to vote for Trump as age increases before a certain age around 68.


```{r, include=TRUE}
survey_data_combo <- survey_data %>%
  select(vote_trump,age) %>%
  group_by(age) %>%
  summarise(total_vote_trump = sum(vote_trump), .groups = 'drop')


survey_data_combo2 <- survey_data %>%
  select(vote_trump,age) %>%
  count(age) %>%
  group_by(age)

ggplot(survey_data_combo, aes(x = age, y = total_vote_trump/survey_data_combo2$n ))+geom_bar(stat='identity', fill="blue", width = 0.7)+labs(title = "Vote to Trump Frequency", x = "Age", y = "Vote Percentage") + geom_smooth( color = 'Red', method = 'gam', formula = y ~ s(x, bs = "cs"))

```
__Figure 2:__ Rate of voting for Trump in different ages. \



|      you will include all results. This includes descriptive statistics, graphs, figures, tables, and model results. Please ensure that everything is well formatted and in a report style. You must also provide an explanation of the results in this section. 

|     Please ensure that everything is well labelled. So if you have multiple histograms and plots, calling them Figure 1, 2, 3, etc. and referencing them as Figure 1, Figure 2, etc. in your report will be expected. The reader should not get lost in a sea of information. Make sure to have the results be clean, well formatted and digestible.

# Discussion

|     Here you will summarize the previous sections and discuss conclusions drawn from the results. Make sure to elaborate and connect your analysis to the goal of the study.

## Weaknesses

|     Since the data we chose are from 2018, data may be outdated and results may vary. Due to the large outbreak of COVID-19 in 2020, people’s voting intentions might change according to Donald Trump’s government’s response to COVID-19 pandemic and policy changes.

|     In both census_data and survey_data, rows that have “Asian or pacific islander” in the race_ethnicity column may affect the proportion outcome. Since, not all parts of Asian and pacific islander can be considered as one group. 



## Next Steps

|     As mentioned above, there's the possibility of lurking variables that we have yet to observe. Therefore a similar analysis will need to be conducted on various other factors in the American Community Survey 2018 Sample.

|     Since the election is scheduled on Nov/ 3rd, 2020, we will search on the internet afterwards to compare the support rate of each candidate and compare it with other analysis. An online survey will be created related to people’s voting intentions in 2018 and who they vote for in 2020.


# References

1. AMERICAN COMMUNITY SURVEY 2018 SAMPLE. (n.d.). Retrieved from https://usa.ipums.org/usa-action/samples

3. Tidyr. (n.d.). Retrieved from https://www.rdocumentation.org/packages/tidyr/versions/0.8.3/topics/drop_na

4. kableExtra. (n.d.) Retrieved from https://www.rdocumentation.org/packages/kableExtra/versions/1.2.1




